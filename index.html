To add PDF import capabilities, file parsing, and AI-driven suggestions with citations, I have significantly upgraded the tool.
New Features in v3.0
 * Smart PDF/Text Import: You can now upload a PDF (e.g., a discharge letter or referral). The tool uses an embedded PDF engine to extract the text and attach it to your prompt.
 * "AI Supervisor" Mode: A new toggle that instructs the AI not just to write the note, but to critique it, suggest missing labs/tests based on guidelines (IMA/ESC/AHA), and cite objective sources.
 * Save/Load Cases: You can now export your presentation data to a JSON file and load it back later (perfect for saving a "work in progress").
Installation Instructions
 * Open your szmc-geriatrics-pro repository.
 * Open index.html.
 * Delete everything and paste the code below.
 * Commit changes.
<!-- end list -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SZMC Pro: AI Medical Command Center</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    <style>
        :root {
            --primary: #005eb8; 
            --secondary: #003087;
            --accent: #d32f2f;
            --success: #2e7d32;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #333333;
            --border: #e0e0e0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        /* Header & Toolbar */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        h1 { margin: 0; font-size: 1.8rem; color: var(--secondary); }
        .badge { background: var(--primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; vertical-align: middle; }
        
        .toolbar {
            display: flex;
            gap: 10px;
        }

        /* Controls Grid */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 0.9rem; }
        
        select, input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        /* Upload Zone */
        .upload-zone {
            border: 2px dashed var(--primary);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #eef4fc;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .upload-zone:hover { background: #dfe9f5; }
        .file-status { font-size: 0.9rem; margin-top: 10px; color: var(--success); font-weight: bold; }

        /* Form Layouts */
        .section-title {
            font-size: 1.1rem;
            color: var(--primary);
            margin-top: 25px;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }

        textarea { resize: vertical; min-height: 80px; font-family: inherit; }

        /* Buttons */
        .actions {
            margin-top: 30px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary { background-color: var(--primary); color: white; flex: 2; }
        .btn-primary:hover { background-color: var(--secondary); }
        .btn-secondary { background-color: white; border: 2px solid var(--border); color: var(--text); }
        .btn-secondary:hover { border-color: var(--primary); color: var(--primary); }
        .btn-file { background-color: #eef4fc; color: var(--primary); border: 1px solid var(--primary); padding: 5px 10px; font-size: 0.9rem; }

        /* Output Area */
        #output-area {
            margin-top: 30px;
            background: #2d2d2d;
            color: #f8f8f2;
            border-radius: 8px;
            padding: 20px;
            display: none;
        }

        .output-header { display: flex; justify-content: space-between; margin-bottom: 15px; color: #fff; }
        pre { white-space: pre-wrap; font-family: 'Courier New', Courier, monospace; font-size: 0.95rem; }

        .hidden { display: none; }
        
        /* Toggle Switch */
        .toggle-container { display: flex; align-items: center; gap: 10px; margin-top: 5px; }
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(16px); }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>SZMC Pro <span class="badge">v3.0</span></h1>
            <small style="color: #666;">AI Medical Architect & Supervisor</small>
        </div>
        <div class="toolbar">
            <input type="file" id="importFile" accept=".json" style="display:none" onchange="loadCase(this)">
            <button class="btn-secondary" onclick="document.getElementById('importFile').click()">üìÇ Load Case</button>
            <button class="btn-secondary" onclick="saveCase()">üíæ Save Case</button>
        </div>
    </header>

    <div class="upload-zone" id="drop-zone">
        <h3>üìÑ Drag & Drop Medical Documents (PDF)</h3>
        <p style="margin:0; color:#666;">Or click to upload. (Discharge letters, Lab results, Referrals)</p>
        <input type="file" id="pdf-input" accept="application/pdf" style="display:none" onchange="handleFileSelect(this)">
        <div id="file-status" class="file-status"></div>
        <textarea id="extracted-pdf-content" class="hidden"></textarea>
    </div>

    <div class="controls">
        <div>
            <label>Specialty</label>
            <select id="specialty" onchange="updateForm()">
                <option value="internal">Internal Medicine</option>
                <option value="geriatrics" selected>Geriatrics</option>
                <option value="surgery">Surgery</option>
                <option value="pediatrics">Pediatrics</option>
                <option value="psychiatry">Psychiatry</option>
                <option value="obgyn">OB/GYN</option>
            </select>
        </div>
        <div>
            <label>Output Type</label>
            <select id="format">
                <option value="case">Presentation</option>
                <option value="admission">Admission Note</option>
                <option value="discharge">Discharge Letter</option>
            </select>
        </div>
        <div>
            <label>Language</label>
            <select id="language">
                <option value="english">English</option>
                <option value="hebrew">Hebrew</option>
            </select>
        </div>
        <div>
            <label>AI Supervisor Mode</label>
            <div class="toggle-container">
                <label class="toggle-switch">
                    <input type="checkbox" id="ai-fix-mode">
                    <span class="slider"></span>
                </label>
                <span style="font-size: 0.85rem;">Review, Fix & Cite Sources</span>
            </div>
        </div>
    </div>

    <div class="section-title">Patient Profile</div>
    <div class="grid-3">
        <div><label>Age</label><input type="number" id="age" placeholder="e.g. 82"></div>
        <div><label>Gender</label><select id="sex"><option>Male</option><option>Female</option></select></div>
        <div><label>Chief Complaint</label><input type="text" id="cc" placeholder="Main reason for arrival"></div>
    </div>

    <div class="section-title">History</div>
    <textarea id="hpi" placeholder="HPI: Timeline, symptoms, aggravating factors..."></textarea>
    
    <div class="grid-2" style="margin-top:15px;">
        <div><label>PMH</label><textarea id="pmh" rows="3" placeholder="Chronic conditions"></textarea></div>
        <div><label>Medications</label><textarea id="meds" rows="3" placeholder="Current list"></textarea></div>
    </div>

    <div id="spec-geriatrics" class="specialty-section">
        <div class="section-title">Geriatric Assessment</div>
        <div class="grid-2">
            <div><label>Function (ADL/IADL)</label><textarea id="ger-func"></textarea></div>
            <div><label>Geriatric Syndromes</label><textarea id="ger-syn" placeholder="Falls, Delirium, Frailty"></textarea></div>
        </div>
    </div>

    <div id="spec-pediatrics" class="specialty-section hidden">
        <div class="section-title">Pediatric Details</div>
        <textarea id="ped-birth" placeholder="Birth history, development, vaccines"></textarea>
    </div>

    <div id="spec-surgery" class="specialty-section hidden">
        <div class="section-title">Surgical Details</div>
        <textarea id="surg-risk" placeholder="Pre-op risk, airway, prev surgeries"></textarea>
    </div>

    <div id="spec-obgyn" class="specialty-section hidden">
        <div class="section-title">OBGYN Details</div>
        <textarea id="ob-hist" placeholder="G_ P_ LMP, complications"></textarea>
    </div>

    <div id="spec-psychiatry" class="specialty-section hidden">
        <div class="section-title">Psychiatric Details</div>
        <textarea id="psych-hist" placeholder="Substance use, risk assessment"></textarea>
    </div>

    <div class="section-title">Objective & Plan</div>
    <div class="grid-2">
        <div><label>Physical Exam</label><textarea id="pe"></textarea></div>
        <div><label>Labs/Imaging</label><textarea id="labs"></textarea></div>
    </div>
    <div style="margin-top:15px;">
        <label>Assessment & Plan</label>
        <textarea id="plan" style="height: 120px;" placeholder="List problems and proposed plan"></textarea>
    </div>

    <div class="actions">
        <button class="btn-primary" onclick="generateSmartPrompt()">
            <span>‚ú® Generate AI Prompt</span>
        </button>
        <button class="btn-secondary" onclick="resetForm()">
            <span>üóëÔ∏è Reset</span>
        </button>
    </div>

    <div id="output-area">
        <div class="output-header">
            <strong>üöÄ Ready to Paste (ChatGPT / Claude)</strong>
            <button class="btn-secondary" style="background:transparent; color:white; border:1px solid #666;" onclick="copyToClipboard()">Copy to Clipboard</button>
        </div>
        <pre id="prompt-output"></pre>
    </div>
</div>

<script>
    // --- 1. PDF Handling ---
    const dropZone = document.getElementById('drop-zone');
    const pdfInput = document.getElementById('pdf-input');

    dropZone.onclick = () => pdfInput.click();
    
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.background = '#e1eefd';
    });

    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.style.background = '#eef4fc';
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.background = '#eef4fc';
        if(e.dataTransfer.files.length) handleFileSelect({files: e.dataTransfer.files});
    });

    async function handleFileSelect(input) {
        const file = input.files[0];
        if (file.type !== 'application/pdf') return alert('Please upload a PDF file.');
        
        document.getElementById('file-status').innerText = `Processing: ${file.name}...`;
        
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let fullText = "";

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += `--- PDF Page ${i} ---\n${pageText}\n`;
            }

            document.getElementById('extracted-pdf-content').value = fullText;
            document.getElementById('file-status').innerText = `‚úÖ Attached: ${file.name} (${pdf.numPages} pages)`;
        } catch (err) {
            console.error(err);
            document.getElementById('file-status').innerText = "‚ùå Error parsing PDF.";
        }
    }

    // --- 2. Form Logic ---
    function updateForm() {
        document.querySelectorAll('.specialty-section').forEach(el => el.classList.add('hidden'));
        const spec = document.getElementById('specialty').value;
        const target = document.getElementById('spec-' + spec);
        if (target) target.classList.remove('hidden');
    }

    function generateSmartPrompt() {
        const spec = document.getElementById('specialty').value;
        const format = document.getElementById('format').value;
        const lang = document.getElementById('language').value;
        const fixMode = document.getElementById('ai-fix-mode').checked;
        const pdfContent = document.getElementById('extracted-pdf-content').value;

        let prompt = `Role: You are an expert Consultant in ${spec}.\n`;
        prompt += `Task: Create a ${format.toUpperCase()}.\n`;
        prompt += `Language: Output in ${lang === 'hebrew' ? 'HEBREW (Professional Medical)' : 'ENGLISH'}.\n\n`;

        if (fixMode) {
            prompt += `üî¥ CRITICAL INSTRUCTION (SUPERVISOR MODE):\n`;
            prompt += `1. Do not just format the data. CRITIQUE it.\n`;
            prompt += `2. Identify missing fields standard for ${spec}.\n`;
            prompt += `3. Suggest guideline-based improvements (cite Guidelines like ESC, AHA, NICE, or IMA).\n`;
            prompt += `4. If medications dose seems wrong, flag it.\n`;
            prompt += `5. After the critique, provide the polished final document.\n\n`;
        }

        prompt += `--- DATA INPUT ---\n`;
        prompt += `Patient: ${document.getElementById('age').value}y ${document.getElementById('sex').value}\n`;
        prompt += `CC: ${document.getElementById('cc').value}\n`;
        prompt += `HPI: ${document.getElementById('hpi').value}\n`;
        prompt += `PMH: ${document.getElementById('pmh').value}\n`;
        prompt += `Meds: ${document.getElementById('meds').value}\n`;
        
        // Add Specialty Specifics
        if(spec === 'geriatrics') {
            prompt += `Function: ${document.getElementById('ger-func').value}\n`;
            prompt += `Geriatric Syndromes: ${document.getElementById('ger-syn').value}\n`;
        } // Add others as needed...

        prompt += `PE: ${document.getElementById('pe').value}\n`;
        prompt += `Labs/Imaging: ${document.getElementById('labs').value}\n`;
        prompt += `Plan: ${document.getElementById('plan').value}\n`;

        if (pdfContent) {
            prompt += `\n--- ATTACHED SOURCE DOCUMENT (RAW TEXT) ---\n`;
            prompt += `Use this raw text to fill in gaps or correct the summary above:\n`;
            prompt += pdfContent.substring(0, 15000); // Limit chars for token limits
        }

        document.getElementById('prompt-output').innerText = prompt;
        document.getElementById('output-area').style.display = 'block';
        document.getElementById('output-area').scrollIntoView({behavior: "smooth"});
    }

    // --- 3. Save/Load System ---
    function saveCase() {
        const data = {};
        document.querySelectorAll('input, select, textarea').forEach(el => {
            if(el.id) data[el.id] = el.type === 'checkbox' ? el.checked : el.value;
        });
        const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `szmc_case_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
    }

    function loadCase(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = JSON.parse(e.target.result);
            for (const key in data) {
                const el = document.getElementById(key);
                if (el) {
                    if (el.type === 'checkbox') el.checked = data[key];
                    else el.value = data[key];
                }
            }
            updateForm();
            alert('Case loaded successfully!');
        };
        reader.readAsText(file);
    }

    function resetForm() {
        if(confirm("Clear all data?")) {
            document.querySelectorAll("input:not([type=file]), textarea").forEach(e => e.value = "");
            document.getElementById('extracted-pdf-content').value = "";
            document.getElementById('file-status').innerText = "";
            document.getElementById('output-area').style.display = 'none';
        }
    }

    function copyToClipboard() {
        navigator.clipboard.writeText(document.getElementById('prompt-output').innerText)
            .then(() => alert("Copied! Paste into ChatGPT."));
    }
</script>

</body>
</html>
